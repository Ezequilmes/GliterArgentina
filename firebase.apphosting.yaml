runtime: nodejs20
entrypoint: npm run start

env:
  - key: NODE_ENV
    value: production
  - key: NEXT_TELEMETRY_DISABLED
    value: "1"
  - key: PORT
    value: "8080"
  - key: NEXT_PUBLIC_APP_URL
    value: "https://gliter.com.ar"
  # Firebase Admin SDK configuration - Set these in Firebase Console -> App Hosting -> Environment Variables
  - key: FIREBASE_PROJECT_ID
    availability:
      - BUILD
      - RUNTIME
  - key: FIREBASE_PRIVATE_KEY_ID
    availability:
      - BUILD
      - RUNTIME
  - key: FIREBASE_PRIVATE_KEY
    availability:
      - BUILD
      - RUNTIME
  - key: FIREBASE_CLIENT_EMAIL
    availability:
      - BUILD
      - RUNTIME
  - key: FIREBASE_CLIENT_ID
    availability:
      - BUILD
      - RUNTIME
  # MercadoPago configuration - Set these in Firebase Console -> App Hosting -> Environment Variables
  - key: MERCADOPAGO_ACCESS_TOKEN
    availability:
      - BUILD
      - RUNTIME
  - key: NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY
    availability:
      - BUILD
      - RUNTIME

build:
  command: |
    echo ">>> Cleaning node state"
    rm -rf node_modules pnpm-lock.yaml
    echo ">>> Installing dependencies"
    npm install --omit=dev
    echo ">>> Type-check"
    npm run type-check
    echo ">>> Building Next.js app"
    npm run build
  environment:
    - key: NODE_ENV
      value: production

resources:
  cpu: 1
  memoryMiB: 2048
  diskMiB: 4096

handlers:
  - glob: '**'
    script: auto