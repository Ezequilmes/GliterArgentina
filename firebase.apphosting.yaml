runtime: nodejs20
entrypoint: npm run start

env:
  - variable: NODE_ENV
    value: production
  - variable: NEXT_TELEMETRY_DISABLED
    value: "1"
  - variable: PORT
    value: "8080"
  - variable: NEXT_PUBLIC_APP_URL
    value: "https://gliter.com.ar"
  # Firebase Admin SDK configuration - Set these in Firebase Console -> App Hosting -> Environment Variables
  - variable: FIREBASE_PROJECT_ID
    availability:
      - BUILD
      - RUNTIME
  - variable: FIREBASE_PRIVATE_KEY_ID
    availability:
      - BUILD
      - RUNTIME
  - variable: FIREBASE_PRIVATE_KEY
    availability:
      - BUILD
      - RUNTIME
  - variable: FIREBASE_CLIENT_EMAIL
    availability:
      - BUILD
      - RUNTIME
  - variable: FIREBASE_CLIENT_ID
    availability:
      - BUILD
      - RUNTIME
  # MercadoPago configuration - Set these in Firebase Console -> App Hosting -> Environment Variables
  - variable: MERCADOPAGO_ACCESS_TOKEN
    value: "APP_USR-2100654215920021-090302-fcde5bf150a88e7b9f2223ca0dd2a1e0-93900446"
    availability:
      - RUNTIME
  - variable: NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY
    value: "APP_USR-eef5b234-f79b-46ab-aa28-ffd2369f8060"
    availability:
      - BUILD
      - RUNTIME
  - variable: MERCADOPAGO_WEBHOOK_SECRET
    value: "6123b18eb72dba618750cb40a49ea1d26440e748bcf25dd13ce08f8a5fcfe2f2"
    availability:
      - RUNTIME
  - variable: MERCADOPAGO_WEBHOOK_URL
    value: "https://gliter.com.ar/api/mercadopago/webhook"
    availability:
      - RUNTIME
  - variable: MERCADOPAGO_STATEMENT_DESCRIPTOR
    value: "GLITER"
    availability:
      - RUNTIME

build:
  command: |
    echo ">>> Cleaning node state"
    rm -rf node_modules pnpm-lock.yaml
    echo ">>> Installing dependencies"
    npm install --omit=dev
    echo ">>> Type-check"
    npm run type-check
    echo ">>> Building Next.js app"
    npm run build
  environment:
    - variable: NODE_ENV
      value: production

resources:
  cpu: 1
  memoryMiB: 2048
  diskMiB: 4096

handlers:
  - glob: '**'
    script: auto
