runtime: nodejs20
entrypoint: npm run start

env:
  - key: NODE_ENV
    value: production
  - key: NEXT_TELEMETRY_DISABLED
    value: "1"
  - key: PORT
    value: "8080"
  - key: NEXT_PUBLIC_APP_URL
    value: "https://gliter.com.ar"
  # Firebase Admin SDK configuration (using GOOGLE_APPLICATION_CREDENTIALS)
  - key: GOOGLE_APPLICATION_CREDENTIALS
    secret: GOOGLE_APPLICATION_CREDENTIALS
    availability:
      - RUNTIME
  # MercadoPago configuration
  - key: MERCADOPAGO_ACCESS_TOKEN
    secret: MERCADOPAGO_ACCESS_TOKEN  # usa el secreto anterior
    availability:
      - RUNTIME                        # no hace falta en BUILD
  - key: NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY
    value: "APP_USR-7c5a0b8e-b8b5-4b8e-8b8e-8b8e8b8e8b8e"
    availability:
      - BUILD
      - RUNTIME
  - key: MERCADOPAGO_CLIENT_ID
    value: "1234567890123456"
    availability:
      - BUILD
      - RUNTIME
  - key: MERCADOPAGO_CLIENT_SECRET
    value: "abcdef1234567890abcdef1234567890"
    availability:
      - BUILD
      - RUNTIME

build:
  command: |
    echo ">>> Cleaning environment"
    rm -rf node_modules
    echo ">>> Installing production deps"
    npm install --omit=dev
    npm run type-check
    npm run build
  environment:
    - key: NODE_ENV
      value: production

resources:
  cpu: 1
  memoryMiB: 2048
  diskMiB: 4096

handlers:
  - glob: '**'
    script: auto