runtime: nodejs20
entrypoint: npm run start

env:
  - key: NODE_ENV
    value: production
  - key: NEXT_TELEMETRY_DISABLED
    value: "1"
  - key: PORT
    value: "8080"

build:
  command: |
    echo ">>> Cleaning node state"
    rm -rf node_modules package-lock.json pnpm-lock.yaml
    echo ">>> Installing production deps"
    npm ci --omit=dev
    echo ">>> Type-check"
    npm run type-check
    echo ">>> Run build"
    npm run build
  environment:
    - key: NODE_ENV
      value: production

resources:
  cpu: 1
  memoryMiB: 2048
  diskMiB: 4096

handlers:
  - glob: '**'
    script: auto