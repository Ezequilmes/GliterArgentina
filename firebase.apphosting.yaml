runtime: nodejs20
entrypoint: npm run start

env:
  - key: NODE_ENV
    value: production
  - key: NEXT_TELEMETRY_DISABLED
    value: "1"
  - key: PORT
    value: "8080"
  - key: NEXT_PUBLIC_APP_URL
    value: "https://www.gliter.com.ar"
  - key: DEBUG_MERCADOPAGO
    value: "1"
  # Firebase Admin SDK configuration (GOOGLE_APPLICATION_CREDENTIALS disabled to allow ADC)
  # - key: GOOGLE_APPLICATION_CREDENTIALS
  #   secret: GOOGLE_APPLICATION_CREDENTIALS
  #   availability:
  #     - RUNTIME
  # MercadoPago configuration - PRODUCTION CREDENTIALS
  - key: MERCADOPAGO_ACCESS_TOKEN
    secret: MERCADOPAGO_ACCESS_TOKEN
    availability:
      - RUNTIME
  - key: NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY
    secret: NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY
    availability:
      - BUILD
      - RUNTIME
  - key: MERCADOPAGO_CLIENT_ID
    secret: MERCADOPAGO_CLIENT_ID
    availability:
      - BUILD
      - RUNTIME
  - key: MERCADOPAGO_CLIENT_SECRET
    secret: MERCADOPAGO_CLIENT_SECRET
    availability:
      - RUNTIME
  - key: MERCADOPAGO_WEBHOOK_SECRET
    secret: MERCADOPAGO_WEBHOOK_SECRET
    availability:
      - RUNTIME

build:
  command: |
    echo ">>> Cleaning environment"
    rm -rf node_modules package-lock.json
    echo ">>> Installing production deps"
    npm ci --omit=dev
    npm run type-check
    npm run build
  environment:
    - key: NODE_ENV
      value: production

resources:
  cpu: 1
  memoryMiB: 2048
  diskMiB: 4096

handlers:
  - glob: '**'
    script: auto